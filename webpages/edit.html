<!DOCTYPE html>
<html lang="en">
<head>
<title>Code With Friends</title>
<style type="text/css" media="screen">
    .myeditor { 
        height: 250px; 
        width: 500px;
    }
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="http://ace.ajax.org/build/src/ace.js" type="text/javascript" charset="utf-8"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
</head>
<body>


<div style="width: 80%;">
    <div class="form-control" id="executedCode" style="overflow-y: scroll; height:250px;"></div>

    <div class="row">
        <div class="col-md-6">
            <div class="myeditor" id="editor1">def foo(items):
    x = "All this is syntax highlighted"
    return x</div>
            <form action="/executecode/submit" method="POST">
                <input type="submit" value="Code"/>
            </form>
        </div>

        <div class="col-md-6">
            <div class="myeditor" id="editor2">def bar(items):
    y = "This too!"
    return y</div>
            <form action="/executecode/submit" method="POST">
                <input type="submit" value="Code"/>
            </form>
        </div>
    </div>
</div>
<script>
    var editors = []
    var numEditors = 2;
    for (i = 0; i < numEditors; i++) {
        editors[i] = ace.edit("editor" + (i+1));
        editors[i].setTheme("ace/theme/monokai");
        editors[i].getSession().setMode("ace/mode/python");
    }

    $('form').submit(function() {
        $theForm = $(this);
        console.log($theForm);
        var editorId = $(this).prev().attr('id');
        var editorNumber = editorId[editorId.length - 1];
        var editor = editors[editorNumber - 1];
        console.log(editor.getSession().getValue());
        // send xhr request
        $.ajax({
            type: $theForm.attr('method'),
            url: $theForm.attr('action'),
            data: {codeToExecute : editor.getSession().getValue()},
            success: function(data) {
                console.log('Yay! Form sent.');
            }
        });

        // prevent submitting again
        return false;
    });


    (function pollForExecutedCode() {
        setTimeout(function() {
            $.ajax({
                url: "/readexecutedcode/",
                type: "POST",
                success: function(data) {
                    console.log("got data: " + data);
                    ta = document.getElementById("executedCode");
                    console.log(data.substr(0, 4));
                    if (data.substr(0, 4) == "INP:") {
                        $("#executedCode").append("<pre class='bg-info'>" + data.substr(4) + "\<\/pre><br>");
                    } else if (data.substr(0, 4) == "OUT:") {
                        $("#executedCode").append("<pre class='bg-success'>" + data.substr(4) + "\<\/pre><br>");
                    } else if (data.substr(0, 4) == "ERR:") {
                        $("#executedCode").append("<pre class='bg-danger'>" + data.substr(4) + "\<\/pre><br>");
                    }

                    
                    $("#executedCode").animate({
                        scrollTop:$("#executedCode")[0].scrollHeight - $("#executedCode").height()
                    })
                },
                complete: pollForExecutedCode,
                timeout: 2000
            })
        }, 5000);
    })();

</script>


</body>
</html>






